/***************************************************************************************
supersimple color-picker jQuery plug-in
author: Todd Resudek http://supersimple.org
version: 1.0
released: 5/2012

adapted from:
jQuery miniColors: A small color selector
Copyright 2011 Cory LaViska for A Beautiful Site, LLC. (http://abeautifulsite.net/)
Dual licensed under the MIT or GPL Version 2 licenses

***************************************************************************************/
if(jQuery)(function(a){a.extend(a.fn,{miniColors:function(b,c,d){var e=function(b,c,d){var e=r(b.val());if(!e)e="8B8B8B";var f=w(e);var g=a('<a class="miniColors-trigger" style="background-color: #'+e+'" href="#"></a>');g.insertAfter(b);b.hide();b.addClass("miniColors").attr("maxlength",7).attr("autocomplete","off");b.data("trigger",g);b.data("hsb",f);if(c.change)b.data("change",c.change);if(c.readonly)b.attr("readonly",true);if(c.disabled)i(b);g.bind("click.miniColors",function(a){a.preventDefault();b.trigger("focus")});b.bind("focus.miniColors",function(a){j(b)});b.bind("blur.miniColors",function(a){var c=r(b.val());b.val(c?"#"+c:"")});b.bind("keydown.miniColors",function(a){if(a.keyCode===9)k(b)});b.bind("keyup.miniColors",function(a){var c=b.val().replace(/[^A-F0-9#]/ig,"");b.val(c);if(!o(b)){b.data("trigger").css("backgroundColor","#FFF")}});b.bind("paste.miniColors",function(a){setTimeout(function(){b.trigger("keyup")},5)})};var f=function(b){k();b=a(b);b.data("trigger").remove();b.removeAttr("autocomplete");b.removeData("trigger");b.removeData("selector");b.removeData("hsb");b.removeData("huePicker");b.removeData("colorPicker");b.removeData("mousebutton");b.removeData("moving");b.unbind("click.miniColors");b.unbind("focus.miniColors");b.unbind("blur.miniColors");b.unbind("keyup.miniColors");b.unbind("keydown.miniColors");b.unbind("paste.miniColors");a(document).unbind("mousedown.miniColors");a(document).unbind("mousemove.miniColors")};var g=function(a){a.attr("disabled",false)};var i=function(a){k(a);a.attr("disabled",true)};var j=function(c){if(c.attr("disabled"))return false;k();var d=a('<div class="miniColors-selector">');d.append('<img class="miniColors-arrow" src="img/color-picker-arrow.png" alt="" />');d.append('<img class="miniColors-close" src="img/small_close_x.png" alt="X" />');var e='<div class="miniColors-defaults">';for(var f=0;f<b.length;f++){pos=f+1;cls=pos%5==0?'class="last"':"";e+='<a title="'+b[f]+'" style="background-color:'+b[f]+'" '+cls+"></a>"}e+="</div>";if(b.length>0){d.append(e)}d.append('<div class="miniColors-colors"><div class="miniColors-colorPicker"></div></div>');d.append('<div class="miniColors-hues"><div class="miniColors-huePicker"></div></div>');d.append("</div>");d.css({left:c.is(":visible")?c.offset().left+c.outerWidth():c.data("trigger").offset().left+c.data("trigger").outerWidth(),top:c.is(":visible")?c.offset().top-5:c.data("trigger").offset().top-5,display:"none"}).addClass(c.attr("class"));var g=c.data("hsb");d.find(".miniColors-colors").css("backgroundColor","#"+x({h:g.h,s:100,b:100}));var h=c.data("colorPosition");if(!h)h=p(g);d.find(".miniColors-colorPicker").css("top",h.y+"px").css("left",h.x+"px");var i=c.data("huePosition");if(!i)i=q(g);d.find(".miniColors-huePicker").css("top",i.y+"px");c.data("selector",d);c.data("huePicker",d.find(".miniColors-huePicker"));c.data("colorPicker",d.find(".miniColors-colorPicker"));c.data("mousebutton",0);a("BODY").append(d);d.fadeIn(100);d.bind("selectstart",function(){return false});a(document).bind("mousedown.miniColors",function(b){c.data("mousebutton",1);if(b.target.className=="miniColors-close"){k(c)}if(a(b.target).parent().hasClass("miniColors-defaults")){var d=a(b.target).attr("title");c.val(d);o(c)}if(a(b.target).parents().andSelf().hasClass("miniColors-colors")){b.preventDefault();c.data("moving","colors");l(c,b)}if(a(b.target).parents().andSelf().hasClass("miniColors-hues")){b.preventDefault();c.data("moving","hues");m(c,b)}if(a(b.target).parents().andSelf().hasClass("miniColors-selector")){b.preventDefault();return}if(a(b.target).parents().andSelf().hasClass("miniColors"))return;k(c)});a(document).bind("mouseup.miniColors",function(a){c.data("mousebutton",0);c.removeData("moving")});a(document).bind("mousemove.miniColors",function(a){if(c.data("mousebutton")===1){if(c.data("moving")==="colors")l(c,a);if(c.data("moving")==="hues")m(c,a)}})};var k=function(b){if(!b)b=".miniColors";a(b).each(function(){var b=a(this).data("selector");a(this).removeData("selector");a(b).fadeOut(100,function(){a(this).remove()})});a(document).unbind("mousedown.miniColors");a(document).unbind("mousemove.miniColors")};var l=function(b,c){var d=b.data("colorPicker");d.hide();var e={x:c.clientX-b.data("selector").find(".miniColors-colors").offset().left+a(document).scrollLeft()-5,y:c.clientY-b.data("selector").find(".miniColors-colors").offset().top+a(document).scrollTop()-5};if(e.x<=-5)e.x=-5;if(e.x>=94)e.x=94;if(e.y<=-5)e.y=-5;if(e.y>=94)e.y=94;b.data("colorPosition",e);d.css("left",e.x).css("top",e.y).show();var f=Math.round((e.x+5)*1);if(f<0)f=0;if(f>100)f=100;var g=100-Math.round((e.y+5)*1);if(g<0)g=0;if(g>100)g=100;var h=b.data("hsb");h.s=f;h.b=g;n(b,h,true)};var m=function(b,c){var d=b.data("huePicker");d.hide();var e={y:c.clientY-b.data("selector").find(".miniColors-colors").offset().top+a(document).scrollTop()-1};if(e.y<=-1)e.y=-1;if(e.y>=99)e.y=99;b.data("huePosition",e);d.css("top",e.y).show();var f=Math.round((100-e.y-1)*3.6);if(f<0)f=0;if(f>360)f=360;var g=b.data("hsb");g.h=f;n(b,g,true)};var n=function(a,b,c){a.data("hsb",b);var d=x(b);if(c)a.val("#"+d);a.data("trigger").css("backgroundColor","#"+d);if(a.data("selector"))a.data("selector").find(".miniColors-colors").css("backgroundColor","#"+x({h:b.h,s:100,b:100}));if(a.data("change")){a.data("change").call(a,"#"+d,s(b))}};var o=function(b){var c=r(b.val());if(!c)return false;var d=w(c);var e=b.data("hsb");if(d.h===e.h&&d.s===e.s&&d.b===e.b)return true;var f=p(d);var g=a(b.data("colorPicker"));g.css("top",f.y+"px").css("left",f.x+"px");var h=q(d);var i=a(b.data("huePicker"));i.css("top",h.y+"px");n(b,d,false);return true};var p=function(a){var b=Math.ceil(a.s/1);if(b<0)b=0;if(b>100)b=100;var c=100-Math.ceil(a.b/1);if(c<0)c=0;if(c>100)c=100;return{x:b-5,y:c-5}};var q=function(a){var b=100-a.h/3.6;if(b<0)h=0;if(b>100)h=100;return{y:b-1}};var r=function(a){a=a.replace(/[^A-Fa-f0-9]/,"");if(a.length==3){a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]}return a.length===6?a:null};var s=function(a){var b={};var c=Math.round(a.h);var d=Math.round(a.s*255/100);var e=Math.round(a.b*255/100);if(d==0){b.r=b.g=b.b=e}else{var f=e;var g=(255-d)*e/255;var h=(f-g)*(c%60)/60;if(c==360)c=0;if(c<60){b.r=f;b.b=g;b.g=g+h}else if(c<120){b.g=f;b.b=g;b.r=f-h}else if(c<180){b.g=f;b.r=g;b.b=g+h}else if(c<240){b.b=f;b.r=g;b.g=f-h}else if(c<300){b.b=f;b.g=g;b.r=g+h}else if(c<360){b.r=f;b.g=g;b.b=f-h}else{b.r=0;b.g=0;b.b=0}}return{r:Math.round(b.r),g:Math.round(b.g),b:Math.round(b.b)}};var t=function(b){var c=[b.r.toString(16),b.g.toString(16),b.b.toString(16)];a.each(c,function(a,b){if(b.length==1)c[a]="0"+b});return c.join("")};var u=function(a){var a=parseInt(a.indexOf("#")>-1?a.substring(1):a,16);return{r:a>>16,g:(a&65280)>>8,b:a&255}};var v=function(a){var b={h:0,s:0,b:0};var c=Math.min(a.r,a.g,a.b);var d=Math.max(a.r,a.g,a.b);var e=d-c;b.b=d;b.s=d!=0?255*e/d:0;if(b.s!=0){if(a.r==d){b.h=(a.g-a.b)/e}else if(a.g==d){b.h=2+(a.b-a.r)/e}else{b.h=4+(a.r-a.g)/e}}else{b.h=-1}b.h*=60;if(b.h<0){b.h+=360}b.s*=100/255;b.b*=100/255;return b};var w=function(a){var b=v(u(a));if(b.s===0)b.h=360;return b};var x=function(a){return t(s(a))};switch(c){case"readonly":a(this).each(function(){a(this).attr("readonly",d)});return a(this);break;case"disabled":a(this).each(function(){if(d){i(a(this))}else{g(a(this))}});return a(this);case"value":a(this).each(function(){a(this).val(d).trigger("keyup")});return a(this);break;case"destroy":a(this).each(function(){f(a(this))});return a(this);default:if(!c)c={};a(this).each(function(){if(a(this)[0].tagName.toLowerCase()!=="input")return;if(a(this).data("trigger"))return;e(a(this),c,d)});return a(this)}}})})(jQuery)